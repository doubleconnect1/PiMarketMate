<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pi Market Mate</title>
  <style>
    *,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::before,::after{--tw-content:''}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}button{background-image:none}button:focus{outline:2px solid transparent;outline-offset:2px}select,[type=number],[type=text]{-webkit-appearance:textfield;-moz-appearance:textfield;appearance:textfield}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.min-h-screen{min-height:100vh}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.w-full{width:100%}.max-w-md{max-width:28rem}.border-2{border-width:2px}.border-solid{border-style:solid}.border-dashed{border-style:dashed}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-bg-opacity))}.border-gray-400{--tw-border-opacity:1;border-color:rgb(156 163 175 / var(--tw-border-opacity))}.border-blue-500{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity))}.rounded-md{border-radius:0.375rem}.p-2{padding:0.5rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.text-center{text-align:center}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.font-medium{font-weight:500}.font-semibold{font-weight:600}.font-bold{font-weight:700}.text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity))}.text-green-500{--tw-text-opacity:1;color:rgb(34 197 94 / var(--tw-text-opacity))}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity))}.hover\:bg-gray-400:hover{--tw-bg-opacity:1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity))}.focus\:ring-gray-300:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(209 213 219 / var(--tw-ring-opacity))}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.flex{display:flex}.hidden{display:none}.items-center{align-items:center}.justify-center{justify-content:center}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * calc(1 - var(--tw-space-x-reverse)));margin-left:calc(1rem * var(--tw-space-x-reverse))}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.block{display:block}.flex-1{flex:1 1 0%}.max-h-40{max-height:10rem}.overflow-y-auto{overflow-y:auto}
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-out;
    }
    #pdf-viewer {
      display: none;
      margin-top: 20px;
      padding: 10px;
      background-color: #fff;
      border: 2px solid #e5e7eb;
      border-radius: 0.375rem;
      max-height: 70vh;
      overflow-y: auto;
      width: 100%;
      max-width: 800px;
    }
    #pdf-content iframe {
      width: 100%;
      height: 500px;
      border: none;
    }
    #pdf-fallback {
      color: #dc2626;
      font-size: 0.875rem;
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold text-center mb-4 flex items-center justify-center">
      <img src="https://raw.githubusercontent.com/doubleconnect1/PiMarketMate/main/assets/pi-logo.png" alt="Pi Network Logo" class="h-5 w-5 mr-2" />
      Pi Market Mate
    </h1>
    <p class="text-center text-gray-600 mb-4">Find out how much Pi you need for a product or service using CoinGecko's official Pi price.</p>
    <div class="mb-4">
      <label for="currency" class="block text-sm font-bold text-gray-700">1. SELECT CURRENCY: <span id="currency-check" class="hidden text-green-500">✓</span></label>
      <select
        id="currency"
        class="mt-1 block w-full p-2 border-2 border-solid border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-gray-300"
      >
        <option value="USD">USD (United States)</option>
        <option value="EUR">EUR (Eurozone)</option>
        <option value="JPY">JPY (Japan)</option>
        <option value="GBP">GBP (United Kingdom)</option>
        <option value="CHF">CHF (Switzerland)</option>
        <option value="CAD">CAD (Canada)</option>
        <option value="AUD">AUD (Australia)</option>
        <option value="NZD">NZD (New Zealand)</option>
        <option disabled>──────────</option>
        <option value="AFN">AFN (Afghanistan)</option>
        <option value="ALL">ALL (Albania)</option>
        <option value="DZD">DZD (Algeria)</option>
        <option value="AOA">AOA (Angola)</option>
        <option value="XCD">XCD (Antigua and Barbuda)</option>
        <option value="ARS">ARS (Argentina)</option>
        <option value="AMD">AMD (Armenia)</option>
        <option value="AZN">AZN (Azerbaijan)</option>
        <option value="BSD">BSD (Bahamas)</option>
        <option value="BHD">BHD (Bain)</option>
        <option value="BDT">BDT (Bangladesh)</option>
        <option value="BBD">BBD (Barbados)</option>
        <option value="BYN">BYN (Belarus)</option>
        <option value="BZD">BZD (Belize)</option>
        <option value="XOF">XOF (Benin)</option>
        <option value="BTN">BTN (Bhutan)</option>
        <option value="BOB">BOB (Bolivia)</option>
        <option value="BAM">BAM (Bosnia and Herzegovina)</option>
        <option value="BWP">BWP (Botswana)</option>
        <option value="BRL">BRL (Brazil)</option>
        <option value="BND">BND (Brunei)</option>
        <option value="BGN">BGN (Bulgaria)</option>
        <option value="XOF">XOF (Burkina Faso)</option>
        <option value="BIF">BIF (Burundi)</option>
        <option value="KHR">KHR (Cambodia)</option>
        <option value="XAF">XAF (Cameroon)</option>
        <option value="CVE">CVE (Cape Verde)</option>
        <option value="XAF">XAF (Central African Republic)</option>
        <option value="XAF">XAF (Chad)</option>
        <option value="CLP">CLP (Chile)</option>
        <option value="CNY">CNY (China)</option>
        <option value="COP">COP (Colombia)</option>
        <option value="KMF">KMF (Comoros)</option>
        <option value="CDF">CDF (Congo, Democratic Republic)</option>
        <option value="XAF">XAF (Congo, Republic)</option>
        <option value="CRC">CRC (Costa Rica)</option>
        <option value="HRK">HRK (Croatia)</option>
        <option value="CUP">CUP (Cuba)</option>
        <option value="CZK">CZK (Czech Republic)</option>
        <option value="DKK">DKK (Denmark)</option>
        <option value="DJF">DJF (Djibouti)</option>
        <option value="XCD">XCD (Dominica)</option>
        <option value="DOP">DOP (Dominican Republic)</option>
        <option value="USD">USD (Ecuador)</option>
        <option value="EGP">EGP (Egypt)</option>
        <option value="USD">USD (El Salvador)</option>
        <option value="XAF">XAF (Equatorial Guinea)</option>
        <option value="ERN">ERN (Eritrea)</option>
        <option value="ETB">ETB (Ethiopia)</option>
        <option value="FJD">FJD (Fiji)</option>
        <option value="GMD">GMD (Gambia)</option>
        <option value="GEL">GEL (Georgia)</option>
        <option value="GHS">GHS (Ghana)</option>
        <option value="GTQ">GTQ (Guatemala)</option>
        <option value="GNF">GNF (Guinea)</option>
        <option value="XOF">XOF (Guinea-Bissau)</option>
        <option value="GYD">GYD (Guyana)</option>
        <option value="HTG">HTG (Haiti)</option>
        <option value="HNL">HNL (Honduras)</option>
        <option value="HKD">HKD (Hong Kong)</option>
        <option value="HUF">HUF (Hungary)</option>
        <option value="ISK">ISK (Iceland)</option>
        <option value="INR">INR (India)</option>
        <option value="IDR">IDR (Indonesia)</option>
        <option value="IRR">IRR (Iran)</option>
        <option value="IQD">IQD (Iraq)</option>
        <option value="ILS">ILS (Israel)</option>
        <option value="JMD">JMD (Jamaica)</option>
        <option value="JOD">JOD (Jordan)</option>
        <option value="KZT">KZT (Kazakhstan)</option>
        <option value="KES">KES (Kenya)</option>
        <option value="KWD">KWD (Kuwait)</option>
        <option value="KGS">KGS (Kyrgyzstan)</option>
        <option value="LAK">LAK (Laos)</option>
        <option value="LBP">LBP (Lebanon)</option>
        <option value="LSL">LSL (Lesotho)</option>
        <option value="LRD">LRD (Liberia)</option>
        <option value="LYD">LYD (Libya)</option>
        <option value="MGA">MGA (Madagascar)</option>
        <option value="MWK">MWK (Malawi)</option>
        <option value="MYR">MYR (Malaysia)</option>
        <option value="MVR">MVR (Maldives)</option>
        <option value="XOF">XOF (Mali)</option>
        <option value="USD">USD (Marshall Islands)</option>
        <option value="MRO">MRO (Mauritania)</option>
        <option value="MUR">MUR (Mauritius)</option>
        <option value="MXN">MXN (Mexico)</option>
        <option value="USD">USD (Micronesia)</option>
        <option value="MDL">MDL (Moldova)</option>
        <option value="MNT">MNT (Mongolia)</option>
        <option value="MAD">MAD (Morocco)</option>
        <option value="MZN">MZN (Mozambique)</option>
        <option value="MMK">MMK (Myanmar)</option>
        <option value="NAD">NAD (Namibia)</option>
        <option value="AUD">AUD (Nauru)</option>
        <option value="NPR">NPR (Nepal)</option>
        <option value="NIO">NIO (Nicaragua)</option>
        <option value="XOF">XOF (Niger)</option>
        <option value="NGN">NGN (Nigeria)</option>
        <option value="MKD">MKD (North Macedonia)</option>
        <option value="NOK">NOK (Norway)</option>
        <option value="OMR">OMR (Oman)</option>
        <option value="PKR">PKR (Pakistan)</option>
        <option value="USD">USD (Palau)</option>
        <option value="ILS">ILS (Palestine)</option>
        <option value="USD">USD (Panama)</option>
        <option value="PGK">PGK (Papua New Guinea)</option>
        <option value="PYG">PYG (Paraguay)</option>
        <option value="PEN">PEN (Peru)</option>
        <option value="PHP">PHP (Philippines)</option>
        <option value="PLN">PLN (Poland)</option>
        <option value="QAR">QAR (Qatar)</option>
        <option value="RON">RON (Romania)</option>
        <option value="RUB">RUB (Russia)</option>
        <option value="RWF">RWF (Rwanda)</option>
        <option value="XCD">XCD (Saint Kitts and Nevis)</option>
        <option value="XCD">XCD (Saint Lucia)</option>
        <option value="XCD">XCD (Saint Vincent and the Grenadines)</option>
        <option value="WST">WST (Samoa)</option>
        <option value="STD">STD (Sao Tome and Principe)</option>
        <option value="SAR">SAR (Saudi Arabia)</option>
        <option value="XOF">XOF (Senegal)</option>
        <option value="RSD">RSD (Serbia)</option>
        <option value="SCR">SCR (Seychelles)</option>
        <option value="SLL">SLL (Sierra Leone)</option>
        <option value="SGD">SGD (Singapore)</option>
        <option value="SBD">SBD (Solomon Islands)</option>
        <option value="SOS">SOS (Somalia)</option>
        <option value="ZAR">ZAR (South Africa)</option>
        <option value="KRW">KRW (South Korea)</option>
        <option value="SSP">SSP (South Sudan)</option>
        <option value="LKR">LKR (Sri Lanka)</option>
        <option value="SDG">SDG (Sudan)</option>
        <option value="SRD">SRD (Suriname)</option>
        <option value="SEK">SEK (Sweden)</option>
        <option value="SYP">SYP (Syria)</option>
        <option value="TWD">TWD (Taiwan)</option>
        <option value="TJS">TJS (Tajikistan)</option>
        <option value="TZS">TZS (Tanzania)</option>
        <option value="THB">THB (Thailand)</option>
        <option value="USD">USD (Timor-Leste)</option>
        <option value="XOF">XOF (Togo)</option>
        <option value="TOP">TOP (Tonga)</option>
        <option value="TTD">TTD (Trinidad and Tobago)</option>
        <option value="TND">TND (Tunisia)</option>
        <option value="TRY">TRY (Turkey)</option>
        <option value="TMT">TMT (Turkmenistan)</option>
        <option value="AUD">AUD (Tuvalu)</option>
        <option value="UGX">UGX (Uganda)</option>
        <option value="UAH">UAH (Ukraine)</option>
        <option value="AED">AED (United Arab Emirates)</option>
        <option value="UYU">UYU (Uruguay)</option>
        <option value="UZS">UZS (Uzbekistan)</option>
        <option value="VUV">VUV (Vanuatu)</option>
        <option value="VEF">VEF (Venezuela)</option>
        <option value="VND">VND (Vietnam)</option>
        <option value="YER">YER (Yemen)</option>
        <option value="ZMW">ZMW (Zambia)</option>
        <option value="ZWL">ZWL (Zimbabwe)</option>
      </select>
    </div>
    <div id="price-display" class="text-center mb-4">
      <p>Current Pi Price: <span id="pi-price" class="font-semibold">Fetching...</span></p>
    </div>
    <div class="mb-4">
      <label class="block text-sm font-bold text-gray-700">Calculation Mode:</label>
      <div class="flex justify-center space-x-4">
        <button
          id="usd-to-pi-btn"
          class="flex-1 bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 transition"
        >
          Currency to Pi
        </button>
        <button
          id="pi-to-usd-btn"
          class="flex-1 bg-gray-300 text-gray-700 p-2 rounded-md hover:bg-gray-400 transition"
        >
          Pi to Currency
        </button>
      </div>
    </div>
    <div class="mb-4">
      <label id="input-label" for="amount" class="block text-sm font-bold text-gray-700"><span id="input-label-text">2. ENTER AMOUNT (USD):</span> <span id="amount-check" class="hidden text-green-500">✓</span></label>
      <input
        type="number"
        id="amount"
        step="0.01"
        min="0"
        placeholder="e.g., 10000"
        class="mt-1 block w-full p-2 border-2 border-solid border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-gray-300"
      />
    </div>
    <button
      id="calculate-btn"
      class="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 transition"
    >
      Calculate
    </button>
    <div class="mt-4 mb-4 bg-gray-100 p-4 rounded-md border-dashed border-2 border-gray-400">
      <label for="manual-price" class="block text-sm font-bold text-gray-700">Manual Pi Price (Offline or Unsupported Currencies):</label>
      <input
        type="number"
        id="manual-price"
        step="0.0001"
        min="0"
        placeholder="Enter Pi price (e.g., 0.123)"
        class="mt-1 block w-full p-2 border-2 border-solid border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-gray-300"
      />
    </div>
    <div id="result" class="mt-6 text-center hidden bg-blue-100 p-4 rounded-md border-2 border-blue-500 animate-fadeIn">
      <p class="text-2xl font-bold text-gray-800">
        <span id="result-text-prefix"></span>
        <span id="result-value" class="text-blue-700"></span>
      </p>
      <button
        id="pay-with-pi-btn"
        class="mt-4 w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 transition hidden"
      >
        Pay with Pi Wallet
      </button>
    </div>
    <div id="error" class="mt-4 text-center text-red-600 hidden">
      <p id="error-message"></p>
    </div>
    <div class="mt-6">
      <h2 class="text-lg font-semibold text-center mb-2">Recent Calculations</h2>
      <ul id="recent-calculations" class="text-sm text-gray-600 max-h-40 overflow-y-auto"></ul>
    </div>
  </div>
  <footer class="mt-6 text-center text-sm text-gray-600">
    <a href="#" id="privacy-policy-link" class="text-blue-600 hover:underline">Privacy Policy</a> |
    <a href="#" id="terms-of-service-link" class="text-blue-600 hover:underline">Terms of Service</a>
  </footer>
  <div id="pdf-viewer">
    <button id="close-pdf" class="bg-red-600 text-white p-2 rounded-md hover:bg-red-700 transition">Close</button>
    <div id="pdf-content"></div>
    <p id="pdf-fallback" class="hidden">Your browser does not support inline PDF viewing. <a id="pdf-download-link" href="#" class="text-blue-600 hover:underline">Download the PDF</a> instead.</p>
  </div>
  <script>
    let currentMode = 'usd-to-pi';
    let lastPiPrices = {
      AFN: null, ALL: null, DZD: null, EUR: null, AOA: null, XCD: null, ARS: null, AMD: null, AUD: null, AZN: null,
      BSD: null, BHD: null, BDT: null, BBD: null, BYN: null, BZD: null, XOF: null, BTN: null, BOB: null, BAM: null,
      BWP: null, BRL: null, BND: null, BGN: null, BIF: null, KHR: null, XAF: null, CAD: null, CVE: null, CLP: null,
      CNY: null, COP: null, KMF: null, CDF: null, CRC: null, HRK: null, CUP: null, CZK: null, DKK: null, DJF: null,
      DOP: null, USD: null, EGP: null, ERN: null, ETB: null, FJD: null, GMD: null, GEL: null, GHS: null, GTQ: null,
      GNF: null, GYD: null, HTG: null, HNL: null, HKD: null, HUF: null, ISK: null, INR: null, IDR: null, IRR: null,
      IQD: null, ILS: null, JMD: null, JPY: null, JOD: null, KZT: null, KES: null, KRW: null, KWD: null, KGS: null,
      LAK: null, LBP: null, LSL: null, LRD: null, LYD: null, CHF: null, MGA: null, MWK: null, MYR: null, MVR: null,
      MRO: null, MUR: null, MXN: null, MDL: null, MNT: null, MAD: null, MZN: null, MMK: null, NAD: null, NPR: null,
      NZD: null, NIO: null, NGN: null, MKD: null, NOK: null, OMR: null, PKR: null, PGK: null, PYG: null, PEN: null,
      PHP: null, PLN: null, QAR: null, RON: null, RUB: null, RWF: null, STD: null, SAR: null, RSD: null, SCR: null,
      SLL: null, SGD: null, SBD: null, SOS: null, ZAR: null, SSP: null, LKR: null, SDG: null, SRD: null, SEK: null,
      SYP: null, TWD: null, TJS: null, TZS: null, THB: null, TOP: null, TTD: null, TND: null, TRY: null, TMT: null,
      VUV: null, UGX: null, UAH: null, AED: null, GBP: null, UYU: null, UZS: null, VEF: null, VND: null, YER: null,
      ZMW: null, ZWL: null
    };
    let currentCurrency = localStorage.getItem('piMarketMateCurrency') || 'USD';
    let lastCalculatedPiAmount = null;
    let recentCalculations = JSON.parse(localStorage.getItem('piMarketMateCalculations')) || [];
    async function fetchPiPrice(currency) {
      try {
        const response = await fetch(
          `https://api.coingecko.com/api/v3/simple/price?ids=pi-network&vs_currencies=${currency.toLowerCase()}`
        );
        if (!response.ok) {
          throw new Error('Failed to fetch Pi price');
        }
        const data = await response.json();
        if (!data['pi-network'][currency.toLowerCase()]) {
          throw new Error('Currency not supported by CoinGecko');
        }
        const piPrice = data['pi-network'][currency.toLowerCase()];
        lastPiPrices[currency] = piPrice;
        return piPrice;
      } catch (error) {
        console.warn(`Error fetching Pi price for ${currency}:`, error);
        throw error;
      }
    }
    async function updatePiPrice() {
      const manualPriceInput = document.getElementById('manual-price');
      try {
        const piPrice = await fetchPiPrice(currentCurrency);
        document.getElementById('pi-price').textContent = `${currentCurrency} ${piPrice.toFixed(4)}`;
        manualPriceInput.value = piPrice.toFixed(4);
      } catch (error) {
        document.getElementById('pi-price').textContent = 'Unavailable';
        if (lastPiPrices[currentCurrency]) {
          manualPriceInput.value = lastPiPrices[currentCurrency].toFixed(4);
        }
        showError('Pi price unavailable. Enter a manual price below.');
      }
    }
    function getEffectivePiPrice() {
      const manualPrice = parseFloat(document.getElementById('manual-price').value);
      if (!isNaN(manualPrice) && manualPrice > 0) {
        return manualPrice;
      }
      return lastPiPrices[currentCurrency];
    }
    function calculateAmount(amount, piPrice) {
      if (isNaN(amount) || amount <= 0) {
        showError(`Please enter a valid ${currentMode === 'usd-to-pi' ? currentCurrency : 'Pi'} amount.`);
        return null;
      }
      if (isNaN(piPrice) || piPrice <= 0) {
        showError('Pi price is unavailable. Enter a manual price below.');
        return null;
      }
      if (currentMode === 'usd-to-pi') {
        return (amount / piPrice).toFixed(2);
      } else {
        return (amount * piPrice).toFixed(2);
      }
    }
    function saveCalculation(input, result, paid = false) {
      const calculation = {
        mode: currentMode,
        currency: currentCurrency,
        input: parseFloat(input).toFixed(2),
        result: parseFloat(result).toFixed(2),
        timestamp: new Date().toLocaleString(),
        paid: paid
      };
      recentCalculations.unshift(calculation);
      recentCalculations = recentCalculations.slice(0, 5);
      localStorage.setItem('piMarketMateCalculations', JSON.stringify(recentCalculations));
      updateRecentCalculations();
    }
    function updateRecentCalculations() {
      const list = document.getElementById('recent-calculations');
      list.innerHTML = '';
      recentCalculations.forEach(calc => {
        const li = document.createElement('li');
        li.className = 'py-1';
        if (calc.mode === 'usd-to-pi') {
          li.textContent = `${calc.timestamp}: ${calc.input} ${calc.currency} = ${calc.result} Pi${calc.paid ? ' (Paid)' : ''}`;
        } else {
          li.textContent = `${calc.timestamp}: ${calc.input} Pi = ${calc.result} ${calc.currency}${calc.paid ? ' (Paid)' : ''}`;
        }
        list.appendChild(li);
      });
    }
    function showError(message) {
      const errorDiv = document.getElementById('error');
      const errorMessage = document.getElementById('error-message');
      if (errorDiv && errorMessage) {
        errorMessage.textContent = message;
        errorDiv.classList.remove('hidden');
        document.getElementById('result').classList.add('hidden');
      }
    }
    function clearError() {
      const errorDiv = document.getElementById('error');
      if (errorDiv) {
        errorDiv.classList.add('hidden');
      }
    }
    function setMode(mode) {
      currentMode = mode;
      const usdToPiBtn = document.getElementById('usd-to-pi-btn');
      const piToUsdBtn = document.getElementById('pi-to-usd-btn');
      const inputLabelText = document.getElementById('input-label-text');
      const amountCheck = document.getElementById('amount-check');
      if (usdToPiBtn && piToUsdBtn && inputLabelText && amountCheck) {
        if (mode === 'usd-to-pi') {
          usdToPiBtn.classList.remove('bg-gray-300', 'text-gray-700');
          usdToPiBtn.classList.add('bg-blue-600', 'text-white');
          piToUsdBtn.classList.remove('bg-blue-600', 'text-white');
          piToUsdBtn.classList.add('bg-gray-300', 'text-gray-700');
          inputLabelText.textContent = `2. ENTER AMOUNT (${currentCurrency}):`;
        } else {
          piToUsdBtn.classList.remove('bg-gray-300', 'text-gray-700');
          piToUsdBtn.classList.add('bg-blue-600', 'text-white');
          usdToPiBtn.classList.remove('bg-blue-600', 'text-white');
          usdToPiBtn.classList.add('bg-gray-300', 'text-gray-700');
          inputLabelText.textContent = '2. ENTER AMOUNT (PI):';
        }
        document.getElementById('amount').value = '';
        amountCheck.classList.add('hidden');
        document.getElementById('result').classList.add('hidden');
        document.getElementById('pay-with-pi-btn').classList.add('hidden');
      }
    }
    function isPiBrowser() {
      // Rely on hostname for now, as Pi Browser is working on mobile at pimarketmate.com
      return window.location.hostname.includes('pimarketmate.com');
    }
    const usdToPiBtn = document.getElementById('usd-to-pi-btn');
    if (usdToPiBtn) {
      usdToPiBtn.addEventListener('click', () => setMode('usd-to-pi'));
    }
    const piToUsdBtn = document.getElementById('pi-to-usd-btn');
    if (piToUsdBtn) {
      piToUsdBtn.addEventListener('click', () => setMode('pi-to-usd'));
    }
    const currencySelect = document.getElementById('currency');
    const currencyCheck = document.getElementById('currency-check');
    if (currencySelect && currencyCheck) {
      currencySelect.value = currentCurrency;
      currencyCheck.classList.remove('hidden');
      currencySelect.addEventListener('change', (e) => {
        const selectedCurrency = e.target.value.toUpperCase();
        if (lastPiPrices.hasOwnProperty(selectedCurrency)) {
          currentCurrency = selectedCurrency;
          localStorage.setItem('piMarketMateCurrency', selectedCurrency);
          document.getElementById('input-label-text').textContent = 
            currentMode === 'usd-to-pi' ? 
            `2. ENTER AMOUNT (${currentCurrency}):` : 
            '2. ENTER AMOUNT (PI):';
          currencyCheck.classList.remove('hidden');
          updatePiPrice();
        } else {
          currencyCheck.classList.add('hidden');
        }
      });
    }
    const amountInput = document.getElementById('amount');
    const amountCheck = document.getElementById('amount-check');
    if (amountInput && amountCheck) {
      amountInput.addEventListener('input', (e) => {
        const amount = parseFloat(e.target.value);
        if (!isNaN(amount) && amount > 0) {
          amountCheck.classList.remove('hidden');
        } else {
          amountCheck.classList.add('hidden');
        }
      });
    }
    const calculateBtn = document.getElementById('calculate-btn');
    if (calculateBtn) {
      calculateBtn.addEventListener('click', async () => {
        clearError();
        const amount = parseFloat(document.getElementById('amount').value);
        try {
          let piPrice = getEffectivePiPrice();
          if (!piPrice) {
            await fetchPiPrice(currentCurrency);
            piPrice = getEffectivePiPrice();
          }
          const result = calculateAmount(amount, piPrice);
          if (result) {
            const prefix = currentMode === 'usd-to-pi' ? 'You need: ' : 'You get: ';
            const value = currentMode === 'usd-to-pi' ? `${result} Pi` : `${result} ${currentCurrency}`;
            const resultTextPrefix = document.getElementById('result-text-prefix');
            const resultValue = document.getElementById('result-value');
            const resultDiv = document.getElementById('result');
            const payWithPiBtn = document.getElementById('pay-with-pi-btn');
            if (resultTextPrefix && resultValue && resultDiv && payWithPiBtn) {
              resultTextPrefix.textContent = prefix;
              resultValue.textContent = value;
              resultDiv.classList.remove('hidden');
              if (currentMode === 'usd-to-pi') {
                lastCalculatedPiAmount = result;
                payWithPiBtn.classList.remove('hidden');
              } else {
                payWithPiBtn.classList.add('hidden');
              }
              saveCalculation(amount, result);
            }
          }
        } catch (error) {
          showError('Pi price unavailable. Enter a manual price below.');
        }
      });
    }
    const payWithPiBtn = document.getElementById('pay-with-pi-btn');
    if (payWithPiBtn) {
      payWithPiBtn.addEventListener('click', () => {
        if (!isPiBrowser()) {
          showError('Please open this app in Pi Browser to pay with Pi Wallet.');
          return;
        }
        if (lastCalculatedPiAmount) {
          const paymentUrl = `https://wallet.pi?amount=${encodeURIComponent(lastCalculatedPiAmount)}`;
          saveCalculation(document.getElementById('amount').value, lastCalculatedPiAmount, true);
          window.location.href = paymentUrl;
        } else {
          showError('No valid Pi amount available for payment.');
        }
      });
    }
    setMode('usd-to-pi');
    updatePiPrice();
    updateRecentCalculations();

    // PDF Viewer Functionality
    const privacyPolicyLink = document.getElementById('privacy-policy-link');
    const termsOfServiceLink = document.getElementById('terms-of-service-link');
    const pdfViewer = document.getElementById('pdf-viewer');
    const pdfContent = document.getElementById('pdf-content');
    const pdfFallback = document.getElementById('pdf-fallback');
    const pdfDownloadLink = document.getElementById('pdf-download-link');
    const closePdfBtn = document.getElementById('close-pdf');

    function displayPdf(url, title) {
      // Create an iframe to render the PDF
      pdfContent.innerHTML = `<iframe src="${url}#toolbar=0" title="${title}"></iframe>`;
      pdfViewer.style.display = 'block';
      pdfFallback.classList.add('hidden');
      pdfDownloadLink.href = url;

      // Check if the iframe loads successfully
      const iframe = pdfContent.querySelector('iframe');
      iframe.onerror = () => {
        pdfContent.innerHTML = '';
        pdfFallback.classList.remove('hidden');
      };

      // Scroll to the viewer
      pdfViewer.scrollIntoView({ behavior: 'smooth' });
    }

    if (privacyPolicyLink) {
      privacyPolicyLink.addEventListener('click', (e) => {
        e.preventDefault();
        displayPdf('/docs/PrivacyPolicy.pdf', 'Privacy Policy');
      });
    }
    if (termsOfServiceLink) {
      termsOfServiceLink.addEventListener('click', (e) => {
        e.preventDefault();
        displayPdf('/docs/TermsOfService.pdf', 'Terms of Service');
      });
    }
    if (closePdfBtn) {
      closePdfBtn.addEventListener('click', () => {
        pdfViewer.style.display = 'none';
        pdfContent.innerHTML = '';
        pdfFallback.classList.add('hidden');
      });
    }
  </script>
</body>
</html>