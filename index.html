<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pi Market Mate</title>
  <style>
    *,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::before,::after{--tw-content:''}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}button{background-image:none}button:focus{outline:2px solid transparent;outline-offset:2px}[type=number],[type=text]{-webkit-appearance:textfield;-moz-appearance:textfield;appearance:textfield}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.min-h-screen{min-height:100vh}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.w-full{width:100%}.max-w-md{max-width:28rem}.border-2{border-width:2px}.border-solid{border-style:solid}.border-dashed{border-style:dashed}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity))}.border-gray-400{--tw-border-opacity:1;border-color:rgb(156 163 175 / var(--tw-border-opacity))}.border-blue-500{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity))}.rounded-md{border-radius:0.375rem}.p-2{padding:0.5rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.text-center{text-align:center}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.font-medium{font-weight:500}.font-semibold{font-weight:600}.font-bold{font-weight:700}.text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity))}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity))}.hover\:bg-gray-400:hover{--tw-bg-opacity:1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity))}.focus\:ring-gray-300:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(209 213 219 / var(--tw-ring-opacity))}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.flex{display:flex}.hidden{display:none}.items-center{align-items:center}.justify-center{justify-content:center}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * calc(1 - var(--tw-space-x-reverse)));margin-left:calc(1rem * var(--tw-space-x-reverse))}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.block{display:block}.flex-1{flex:1 1 0%}.max-h-40{max-height:10rem}.overflow-y-auto{overflow-y:auto}
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-out;
    }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold text-center mb-4">Pi Market Mate</h1>
    <p class="text-center text-gray-600 mb-4">Find out how much Pi you need for a product or service using CoinGecko's official Pi price.</p>
    <div class="mb-4">
      <label for="currency" class="block text-sm font-medium text-gray-700">Select Currency:</label>
      <input
        list="currencies"
        id="currency"
        class="mt-1 block w-full p-2 border-2 border-solid border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-gray-300"
        placeholder="Type or select a country (e.g., Nigeria)"
      />
      <datalist id="currencies">
        <option value="afn">AFN (Afghanistan)</option>
        <option value="all">ALL (Albania)</option>
        <option value="dzd">DZD (Algeria)</option>
        <option value="eur">EUR (Andorra)</option>
        <option value="aoa">AOA (Angola)</option>
        <option value="xcd">XCD (Antigua and Barbuda)</option>
        <option value="ars">ARS (Argentina)</option>
        <option value="amd">AMD (Armenia)</option>
        <option value="aud">AUD (Australia)</option>
        <option value="eur">EUR (Austria)</option>
        <option value="azn">AZN (Azerbaijan)</option>
        <option value="bsd">BSD (Bahamas)</option>
        <option value="bhd">BHD (Bahrain)</option>
        <option value="bdt">BDT (Bangladesh)</option>
        <option value="bbd">BBD (Barbados)</option>
        <option value="byn">BYN (Belarus)</option>
        <option value="eur">EUR (Belgium)</option>
        <option value="bzd">BZD (Belize)</option>
        <option value="xof">XOF (Benin)</option>
        <option value="btn">BTN (Bhutan)</option>
        <option value="bob">BOB (Bolivia)</option>
        <option value="bam">BAM (Bosnia and Herzegovina)</option>
        <option value="bwp">BWP (Botswana)</option>
        <option value="brl">BRL (Brazil)</option>
        <option value="bnd">BND (Brunei)</option>
        <option value="bgn">BGN (Bulgaria)</option>
        <option value="xof">XOF (Burkina Faso)</option>
        <option value="bif">BIF (Burundi)</option>
        <option value="khr">KHR (Cambodia)</option>
        <option value="xaf">XAF (Cameroon)</option>
        <option value="cad">CAD (Canada)</option>
        <option value="cve">CVE (Cape Verde)</option>
        <option value="xaf">XAF (Central African Republic)</option>
        <option value="xaf">XAF (Chad)</option>
        <option value="clp">CLP (Chile)</option>
        <option value="cny">CNY (China)</option>
        <option value="cop">COP (Colombia)</option>
        <option value="kmf">KMF (Comoros)</option>
        <option value="cdf">CDF (Congo, Democratic Republic)</option>
        <option value="xaf">XAF (Congo, Republic)</option>
        <option value="crc">CRC (Costa Rica)</option>
        <option value="hrk">HRK (Croatia)</option>
        <option value="cup">CUP (Cuba)</option>
        <option value="eur">EUR (Cyprus)</option>
        <option value="czk">CZK (Czech Republic)</option>
        <option value="dkk">DKK (Denmark)</option>
        <option value="djf">DJF (Djibouti)</option>
        <option value="xcd">XCD (Dominica)</option>
        <option value="dop">DOP (Dominican Republic)</option>
        <option value="usd">USD (Ecuador)</option>
        <option value="egp">EGP (Egypt)</option>
        <option value="usd">USD (El Salvador)</option>
        <option value="xaf">XAF (Equatorial Guinea)</option>
        <option value="ern">ERN (Eritrea)</option>
        <option value="eur">EUR (Estonia)</option>
        <option value="szl">SZL (Eswatini)</option>
        <option value="etb">ETB (Ethiopia)</option>
        <option value="fjd">FJD (Fiji)</option>
        <option value="eur">EUR (Finland)</option>
        <option value="eur">EUR (France)</option>
        <option value="xaf">XAF (Gabon)</option>
        <option value="gmd">GMD (Gambia)</option>
        <option value="gel">GEL (Georgia)</option>
        <option value="eur">EUR (Germany)</option>
        <option value="ghs">GHS (Ghana)</option>
        <option value="eur">EUR (Greece)</option>
        <option value="xcd">XCD (Grenada)</option>
        <option value="gtq">GTQ (Guatemala)</option>
        <option value="gnf">GNF (Guinea)</option>
        <option value="xof">XOF (Guinea-Bissau)</option>
        <option value="gyd">GYD (Guyana)</option>
        <option value="htg">HTG (Haiti)</option>
        <option value="hnl">HNL (Honduras)</option>
        <option value="hkd">HKD (Hong Kong)</option>
        <option value="huf">HUF (Hungary)</option>
        <option value="isk">ISK (Iceland)</option>
        <option value="inr">INR (India)</option>
        <option value="idr">IDR (Indonesia)</option>
        <option value="irr">IRR (Iran)</option>
        <option value="iqd">IQD (Iraq)</option>
        <option value="eur">EUR (Ireland)</option>
        <option value="ils">ILS (Israel)</option>
        <option value="eur">EUR (Italy)</option>
        <option value="jmd">JMD (Jamaica)</option>
        <option value="jpy">JPY (Japan)</option>
        <option value="jod">JOD (Jordan)</option>
        <option value="kzt">KZT (Kazakhstan)</option>
        <option value="kes">KES (Kenya)</option>
        <option value="kwd">KWD (Kuwait)</option>
        <option value="kgs">KGS (Kyrgyzstan)</option>
        <option value="lak">LAK (Laos)</option>
        <option value="eur">EUR (Latvia)</option>
        <option value="lbp">LBP (Lebanon)</option>
        <option value="lsl">LSL (Lesotho)</option>
        <option value="lrd">LRD (Liberia)</option>
        <option value="lyd">LYD (Libya)</option>
        <option value="chf">CHF (Liechtenstein)</option>
        <option value="eur">EUR (Lithuania)</option>
        <option value="eur">EUR (Luxembourg)</option>
        <option value="mga">MGA (Madagascar)</option>
        <option value="mwk">MWK (Malawi)</option>
        <option value="myr">MYR (Malaysia)</option>
        <option value="mvr">MVR (Maldives)</option>
        <option value="xof">XOF (Mali)</option>
        <option value="eur">EUR (Malta)</option>
        <option value="usd">USD (Marshall Islands)</option>
        <option value="mro">MRO (Mauritania)</option>
        <option value="mur">MUR (Mauritius)</option>
        <option value="mxn">MXN (Mexico)</option>
        <option value="usd">USD (Micronesia)</option>
        <option value="mdl">MDL (Moldova)</option>
        <option value="eur">EUR (Monaco)</option>
        <option value="mnt">MNT (Mongolia)</option>
        <option value="eur">EUR (Montenegro)</option>
        <option value="mad">MAD (Morocco)</option>
        <option value="mzn">MZN (Mozambique)</option>
        <option value="mmk">MMK (Myanmar)</option>
        <option value="nad">NAD (Namibia)</option>
        <option value="aud">AUD (Nauru)</option>
        <option value="npr">NPR (Nepal)</option>
        <option value="eur">EUR (Netherlands)</option>
        <option value="nzd">NZD (New Zealand)</option>
        <option value="nio">NIO (Nicaragua)</option>
        <option value="xof">XOF (Niger)</option>
        <option value="ngn">NGN (Nigeria)</option>
        <option value="mkd">MKD (North Macedonia)</option>
        <option value="nok">NOK (Norway)</option>
        <option value="omr">OMR (Oman)</option>
        <option value="pkr">PKR (Pakistan)</option>
        <option value="usd">USD (Palau)</option>
        <option value="ils">ILS (Palestine)</option>
        <option value="usd">USD (Panama)</option>
        <option value="pgk">PGK (Papua New Guinea)</option>
        <option value="pyg">PYG (Paraguay)</option>
        <option value="pen">PEN (Peru)</option>
        <option value="php">PHP (Philippines)</option>
        <option value="pln">PLN (Poland)</option>
        <option value="eur">EUR (Portugal)</option>
        <option value="qar">QAR (Qatar)</option>
        <option value="ron">RON (Romania)</option>
        <option value="rub">RUB (Russia)</option>
        <option value="rwf">RWF (Rwanda)</option>
        <option value="xcd">XCD (Saint Kitts and Nevis)</option>
        <option value="xcd">XCD (Saint Lucia)</option>
        <option value="xcd">XCD (Saint Vincent and the Grenadines)</option>
        <option value="wst">WST (Samoa)</option>
        <option value="eur">EUR (San Marino)</option>
        <option value="std">STD (Sao Tome and Principe)</option>
        <option value="sar">SAR (Saudi Arabia)</option>
        <option value="xof">XOF (Senegal)</option>
        <option value="rsd">RSD (Serbia)</option>
        <option value="scr">SCR (Seychelles)</option>
        <option value="sll">SLL (Sierra Leone)</option>
        <option value="sgd">SGD (Singapore)</option>
        <option value="eur">EUR (Slovakia)</option>
        <option value="eur">EUR (Slovenia)</option>
        <option value="sbd">SBD (Solomon Islands)</option>
        <option value="sos">SOS (Somalia)</option>
        <option value="zar">ZAR (South Africa)</option>
        <option value="ssp">SSP (South Sudan)</option>
        <option value="eur">EUR (Spain)</option>
        <option value="lkr">LKR (Sri Lanka)</option>
        <option value="sdg">SDG (Sudan)</option>
        <option value="srd">SRD (Suriname)</option>
        <option value="sek">SEK (Sweden)</option>
        <option value="chf">CHF (Switzerland)</option>
        <option value="syp">SYP (Syria)</option>
        <option value="twd">TWD (Taiwan)</option>
        <option value="tjs">TJS (Tajikistan)</option>
        <option value="tzs">TZS (Tanzania)</option>
        <option value="thb">THB (Thailand)</option>
        <option value="usd">USD (Timor-Leste)</option>
        <option value="xof">XOF (Togo)</option>
        <option value="top">TOP (Tonga)</option>
        <option value="ttd">TTD (Trinidad and Tobago)</option>
        <option value="tnd">TND (Tunisia)</option>
        <option value="try">TRY (Turkey)</option>
        <option value="tmt">TMT (Turkmenistan)</option>
        <option value="aud">AUD (Tuvalu)</option>
        <option value="ugx">UGX (Uganda)</option>
        <option value="uah">UAH (Ukraine)</option>
        <option value="aed">AED (United Arab Emirates)</option>
        <option value="gbp">GBP (United Kingdom)</option>
        <option value="usd">USD (United States)</option>
        <option value="uyu">UYU (Uruguay)</option>
        <option value="uzs">UZS (Uzbekistan)</option>
        <option value="vuv">VUV (Vanuatu)</option>
        <option value="eur">EUR (Vatican City)</option>
        <option value="vef">VEF (Venezuela)</option>
        <option value="vnd">VND (Vietnam)</option>
        <option value="yer">YER (Yemen)</option>
        <option value="zmw">ZMW (Zambia)</option>
        <option value="zwl">ZWL (Zimbabwe)</option>
      </datalist>
    </div>
    <div id="price-display" class="text-center mb-4">
      <p>Current Pi Price: <span id="pi-price" class="font-semibold">Fetching...</span></p>
    </div>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Calculation Mode:</label>
      <div class="flex justify-center space-x-4">
        <button
          id="usd-to-pi-btn"
          class="flex-1 bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 transition"
        >
          Currency to Pi
        </button>
        <button
          id="pi-to-usd-btn"
          class="flex-1 bg-gray-300 text-gray-700 p-2 rounded-md hover:bg-gray-400 transition"
        >
          Pi to Currency
        </button>
      </div>
    </div>
    <div class="mb-4">
      <label id="input-label" for="amount" class="block text-sm font-medium text-gray-700">Enter Amount (USD):</label>
      <input
        type="number"
        id="amount"
        step="0.01"
        min="0"
        placeholder="e.g., 10000"
        class="mt-1 block w-full p-2 border-2 border-solid border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-gray-300"
      />
    </div>
    <button
      id="calculate-btn"
      class="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 transition"
    >
      Calculate
    </button>
    <div class="mt-4 mb-4 bg-gray-100 p-4 rounded-md border-dashed border-2 border-gray-400">
      <label for="manual-price" class="block text-sm font-medium text-gray-700">Manual Pi Price (Offline or Unsupported Currencies):</label>
      <input
        type="number"
        id="manual-price"
        step="0.0001"
        min="0"
        placeholder="Enter Pi price (e.g., 0.123)"
        class="mt-1 block w-full p-2 border-2 border-solid border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-gray-300"
      />
    </div>
    <div id="result" class="mt-6 text-center hidden bg-blue-100 p-4 rounded-md border-2 border-blue-500 animate-fadeIn">
      <p class="text-2xl font-bold text-gray-800">
        <span id="result-text-prefix"></span>
        <span id="result-value" class="text-blue-700"></span>
      </p>
      <button
        id="pay-with-pi-btn"
        class="mt-4 w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 transition hidden"
      >
        Pay with Pi Wallet
      </button>
    </div>
    <div id="error" class="mt-4 text-center text-red-600 hidden">
      <p id="error-message"></p>
    </div>
    <div class="mt-6">
      <h2 class="text-lg font-semibold text-center mb-2">Recent Calculations</h2>
      <ul id="recent-calculations" class="text-sm text-gray-600 max-h-40 overflow-y-auto"></ul>
    </div>
  </div>
  <script>
    let currentMode = 'usd-to-pi';
    let lastPiPrices = {
      afn: null, all: null, dzd: null, eur: null, aoa: null, xcd: null, ars: null, amd: null, aud: null, azn: null,
      bsd: null, bhd: null, bdt: null, bbd: null, byn: null, bzd: null, xof: null, btn: null, bob: null, bam: null,
      bwp: null, brl: null, bnd: null, bgn: null, bif: null, khr: null, xaf: null, cad: null, cve: null, clp: null,
      cny: null, cop: null, kmf: null, cdf: null, crc: null, hrk: null, cup: null, czk: null, dkk: null, djf: null,
      dop: null, usd: null, egp: null, ern: null, etb: null, fjd: null, gmd: null, gel: null, ghs: null, gtq: null,
      gnf: null, gyd: null, htg: null, hnl: null, hkd: null, huf: null, isk: null, inr: null, idr: null, irr: null,
      iqd: null, ils: null, jmd: null, jpy: null, jod: null, kzt: null, kes: null, kwd: null, kgs: null, lak: null,
      lbp: null, lsl: null, lrd: null, lyd: null, chf: null, mga: null, mwk: null, myr: null, mvr: null, mro: null,
      mur: null, mxn: null, mdl: null, mnt: null, mad: null, mzn: null, mmk: null, nad: null, npr: null, nzd: null,
      nio: null, ngn: null, mkd: null, nok: null, omr: null, pkr: null, pgk: null, pyg: null, pen: null, php: null,
      pln: null, qar: null, ron: null, rub: null, rwf: null, std: null, sar: null, rsd: null, scr: null, sll: null,
      sgd: null, sbd: null, sos: null, zar: null, ssp: null, lkr: null, sdg: null, srd: null, sek: null, syp: null,
      twd: null, tjs: null, tzs: null, thb: null, top: null, ttd: null, tnd: null, try: null, tmt: null, vuv: null,
      ugx: null, uah: null, aed: null, gbp: null, uyu: null, uzs: null, vef: null, vnd: null, yer: null, zmw: null,
      zwl: null
    };
    let currentCurrency = localStorage.getItem('piMarketMateCurrency') || 'usd';
    let lastCalculatedPiAmount = null;
    let recentCalculations = JSON.parse(localStorage.getItem('piMarketMateCalculations')) || [];
    async function fetchPiPrice(currency) {
      try {
        const response = await fetch(
          `https://api.coingecko.com/api/v3/simple/price?ids=pi-network&vs_currencies=${currency}`
        );
        if (!response.ok) {
          throw new Error('Failed to fetch Pi price');
        }
        const data = await response.json();
        if (!data['pi-network'][currency]) {
          throw new Error('Currency not supported by CoinGecko');
        }
        const piPrice = data['pi-network'][currency];
        lastPiPrices[currency] = piPrice;
        return piPrice;
      } catch (error) {
        console.warn(`Error fetching Pi price for ${currency}:`, error);
        throw error;
      }
    }
    async function updatePiPrice() {
      const manualPriceInput = document.getElementById('manual-price');
      try {
        const piPrice = await fetchPiPrice(currentCurrency);
        document.getElementById('pi-price').textContent = `${currentCurrency.toUpperCase()} ${piPrice.toFixed(4)}`;
        manualPriceInput.value = piPrice.toFixed(4);
      } catch (error) {
        document.getElementById('pi-price').textContent = 'Unavailable';
        if (lastPiPrices[currentCurrency]) {
          manualPriceInput.value = lastPiPrices[currentCurrency].toFixed(4);
        }
        showError('Pi price unavailable. Enter a manual price below.');
      }
    }
    function getEffectivePiPrice() {
      const manualPrice = parseFloat(document.getElementById('manual-price').value);
      if (!isNaN(manualPrice) && manualPrice > 0) {
        return manualPrice;
      }
      return lastPiPrices[currentCurrency];
    }
    function calculateAmount(amount, piPrice) {
      if (isNaN(amount) || amount <= 0) {
        showError(`Please enter a valid ${currentMode === 'usd-to-pi' ? currentCurrency.toUpperCase() : 'Pi'} amount.`);
        return null;
      }
      if (isNaN(piPrice) || piPrice <= 0) {
        showError('Pi price is unavailable. Enter a manual price below.');
        return null;
      }
      if (currentMode === 'usd-to-pi') {
        return (amount / piPrice).toFixed(2);
      } else {
        return (amount * piPrice).toFixed(2);
      }
    }
    function saveCalculation(input, result, paid = false) {
      const calculation = {
        mode: currentMode,
        currency: currentCurrency.toUpperCase(),
        input: parseFloat(input).toFixed(2),
        result: parseFloat(result).toFixed(2),
        timestamp: new Date().toLocaleString(),
        paid: paid
      };
      recentCalculations.unshift(calculation);
      recentCalculations = recentCalculations.slice(0, 5);
      localStorage.setItem('piMarketMateCalculations', JSON.stringify(recentCalculations));
      updateRecentCalculations();
    }
    function updateRecentCalculations() {
      const list = document.getElementById('recent-calculations');
      list.innerHTML = '';
      recentCalculations.forEach(calc => {
        const li = document.createElement('li');
        li.className = 'py-1';
        if (calc.mode === 'usd-to-pi') {
          li.textContent = `${calc.timestamp}: ${calc.input} ${calc.currency} = ${calc.result} Pi${calc.paid ? ' (Paid)' : ''}`;
        } else {
          li.textContent = `${calc.timestamp}: ${calc.input} Pi = ${calc.result} ${calc.currency}${calc.paid ? ' (Paid)' : ''}`;
        }
        list.appendChild(li);
      });
    }
    function showError(message) {
      const errorDiv = document.getElementById('error');
      const errorMessage = document.getElementById('error-message');
      if (errorDiv && errorMessage) {
        errorMessage.textContent = message;
        errorDiv.classList.remove('hidden');
        document.getElementById('result').classList.add('hidden');
      }
    }
    function clearError() {
      const errorDiv = document.getElementById('error');
      if (errorDiv) {
        errorDiv.classList.add('hidden');
      }
    }
    function setMode(mode) {
      currentMode = mode;
      const usdToPiBtn = document.getElementById('usd-to-pi-btn');
      const piToUsdBtn = document.getElementById('pi-to-usd-btn');
      const inputLabel = document.getElementById('input-label');
      if (usdToPiBtn && piToUsdBtn && inputLabel) {
        if (mode === 'usd-to-pi') {
          usdToPiBtn.classList.remove('bg-gray-300', 'text-gray-700');
          usdToPiBtn.classList.add('bg-blue-600', 'text-white');
          piToUsdBtn.classList.remove('bg-blue-600', 'text-white');
          piToUsdBtn.classList.add('bg-gray-300', 'text-gray-700');
          inputLabel.textContent = `Enter Amount (${currentCurrency.toUpperCase()}):`;
        } else {
          piToUsdBtn.classList.remove('bg-gray-300', 'text-gray-700');
          piToUsdBtn.classList.add('bg-blue-600', 'text-white');
          usdToPiBtn.classList.remove('bg-blue-600', 'text-white');
          usdToPiBtn.classList.add('bg-gray-300', 'text-gray-700');
          inputLabel.textContent = 'Enter Amount (Pi):';
        }
        document.getElementById('amount').value = '';
        document.getElementById('result').classList.add('hidden');
        document.getElementById('pay-with-pi-btn').classList.add('hidden');
      }
    }
    function isPiBrowser() {
      const userAgent = navigator.userAgent.toLowerCase();
      return userAgent.includes('pi') || window.location.hostname.includes('app.pi');
    }
    const usdToPiBtn = document.getElementById('usd-to-pi-btn');
    if (usdToPiBtn) {
      usdToPiBtn.addEventListener('click', () => setMode('usd-to-pi'));
    }
    const piToUsdBtn = document.getElementById('pi-to-usd-btn');
    if (piToUsdBtn) {
      piToUsdBtn.addEventListener('click', () => setMode('pi-to-usd'));
    }
    const currencyInput = document.getElementById('currency');
    if (currencyInput) {
      currencyInput.value = currentCurrency; // Set initial currency
      currencyInput.addEventListener('input', (e) => {
        const selectedCurrency = e.target.value.toLowerCase();
        if (lastPiPrices.hasOwnProperty(selectedCurrency)) {
          currentCurrency = selectedCurrency;
          localStorage.setItem('piMarketMateCurrency', selectedCurrency); // Save to localStorage
          document.getElementById('input-label').textContent = 
            currentMode === 'usd-to-pi' ? 
            `Enter Amount (${currentCurrency.toUpperCase()}):` : 
            'Enter Amount (Pi):';
          updatePiPrice();
        }
      });
    }
    const calculateBtn = document.getElementById('calculate-btn');
    if (calculateBtn) {
      calculateBtn.addEventListener('click', async () => {
        clearError();
        const amount = parseFloat(document.getElementById('amount').value);
        try {
          let piPrice = getEffectivePiPrice();
          if (!piPrice) {
            await fetchPiPrice(currentCurrency);
            piPrice = getEffectivePiPrice();
          }
          const result = calculateAmount(amount, piPrice);
          if (result) {
            const prefix = currentMode === 'usd-to-pi' ? 'You need: ' : 'You get: ';
            const value = currentMode === 'usd-to-pi' ? `${result} Pi` : `${result} ${currentCurrency.toUpperCase()}`;
            const resultTextPrefix = document.getElementById('result-text-prefix');
            const resultValue = document.getElementById('result-value');
            const resultDiv = document.getElementById('result');
            const payWithPiBtn = document.getElementById('pay-with-pi-btn');
            if (resultTextPrefix && resultValue && resultDiv && payWithPiBtn) {
              resultTextPrefix.textContent = prefix;
              resultValue.textContent = value;
              resultDiv.classList.remove('hidden');
              if (currentMode === 'usd-to-pi') {
                lastCalculatedPiAmount = result;
                payWithPiBtn.classList.remove('hidden');
              } else {
                payWithPiBtn.classList.add('hidden');
              }
              saveCalculation(amount, result);
            }
          }
        } catch (error) {
          showError('Pi price unavailable. Enter a manual price below.');
        }
      });
    }
    const payWithPiBtn = document.getElementById('pay-with-pi-btn');
    if (payWithPiBtn) {
      payWithPiBtn.addEventListener('click', () => {
        if (!isPiBrowser()) {
          showError('Please open this app in the Pi Browser to pay with Pi Wallet.');
          return;
        }
        if (lastCalculatedPiAmount) {
          const paymentUrl = `https://wallet.pi?amount=${encodeURIComponent(lastCalculatedPiAmount)}`;
          saveCalculation(document.getElementById('amount').value, lastCalculatedPiAmount, true);
          window.location.href = paymentUrl;
        } else {
          showError('No valid Pi amount available for payment.');
        }
      });
    }
    setMode('usd-to-pi');
    updatePiPrice();
    updateRecentCalculations();
  </script>
</body>
</html>